# Blockchain Music Marketplace - Guideline

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Setup](#setup)
3. [User Roles and Functionalities](#user-roles-and-functionalities)
   - [Music Artist](#music-artist-account-0)
   - [Buyers](#buyers-accounts-1-19)
4. [Additional Features](#additional-features)
5. [Troubleshooting](#troubleshooting)

## Prerequisites

Before starting, ensure the following requirements are met:

1. **MetaMask Installation**

   - Install MetaMask browser extension
   - Clear the activity tab data in MetaMask

2. **Development Environment**

   - Next.js version 14 or higher
   - Solidity version 0.8.4 or higher
   - Node.js and npm (latest stable versions recommended)

3. **Blockchain Setup**

   - Hardhat installed globally: `npm install -g hardhat`
   - Fake accounts generated using `npx hardhat node`
   - Hardhat test network configured in your project

4. **Network Requirements**

   - Stable Wi-Fi connection
   - Minimum 10 Mbps download/upload speed recommended

5. **AWS S3 Configuration**
   - AWS S3 bucket organized with two key folders:
     - `songs`: Dedicated to storing music MP3 files.
     - `database`: Holds JSON files for data management.
   - Ensure AWS credentials are correctly configured in your environment.

## Setup

(Recommended to follow the sequence listed)

1. In the terminal, execute the `npm i` command at the root directory.
2. Run `npx hardhat node` to start the local blockchain
3. Run `npm run deploy` to deploy smart contracts
4. Run `npx hardhat test` to perform unit tests
5. Run `npm run dev` to start the development server
6. Access the application at `localhost:3000` (must be port 3000)
7. Refresh the page to allow the browser to detect MetaMask

## User Roles and Functionalities

### Music Artist (Account 0)

The music artist role is assigned to the first account generated by Hardhat.

#### Access Restrictions

- Can only access the homepage ("/")
- Attempting to access other routes will result in a 404 error page

#### Uploading Music

1. Navigate to the homepage
2. Fill in all required fields:

   - Artist: Enter the artist name
   - Title: Enter the song title
   - ETH Price: Set a price between 0 and 1000 ETH
   - File: Upload the music file (MP3 format recommended)
     - File name must only contain letters, numbers, hyphens, and underscores

3. Click the "Upload" button

   - Button text will change to indicate the upload is in progress
   - Wait for the upload to complete (duration depends on file size and network speed)

4. Upon successful upload:
   - A toast notification will appear in the bottom right corner
   - All input fields will be cleared automatically

#### Deploying Music Contracts

After uploading music, deploy the contracts to the blockchain:

1. Open a new terminal window
2. Run the following command: `npm run deploy`
3. Wait for the deployment to complete
4. Check the console for any error messages or successful deployment logs

### Buyers (Accounts 1-19)

Buyer accounts can be any of the accounts from 1 to 19 generated by Hardhat.

#### Homepage Features

- View a list of available music
- Music playback controls:
- Play/Pause: Click the play/pause button for each track
- Shuffle: Click the shuffle button to randomize the playlist order
- Repeat One: Click the repeat button once to repeat the current song
- Repeat All: Click the repeat button twice to repeat the entire playlist
- Progress Bar: Drag the playbar to skip to different parts of the song

#### Buying Music

1. Play the desired song (mandatory before purchasing)
2. Click the "Buy" button next to the playing song
3. MetaMask popup will appear:
   - Review the transaction details
   - Click "Confirm" to proceed with the purchase, or "Reject" to cancel
4. A toast notification will appear in the bottom right corner indicating the transaction status
5. If purchased successfully, the song token will be transferred to the "My Tokens" tab

#### My Tokens Tab

- Access by clicking "My Tokens" in the navigation menu
- View all purchased music tokens
- For each token:
  - Play: Click the play button to listen to the song
  - Resell: Click the resell button to list the token for sale

1. Enter a resale price (0-1000 ETH)
2. Click the "Resell" button next to the input field
3. MetaMask popup will appear:
   - Review the transaction details
   - Click "Confirm" to proceed with the purchase, or "Reject" to cancel
4. A toast notification will appear in the bottom right corner indicating the transaction status
5. If resold successfully, the song token will be transferred to the "My Tokens" tab

#### My Resales Tab

- Access by clicking "My Resales" in the navigation menu
- Two sections:
  1. Active Resales: Shows currently listed tokens for resale
  2. Sold Resales: Displays history of sold resale tokens
- If either section is empty, a message will indicate no active resales or sold tokens
- If both sections are empty, a spinning cube animation will appear with a message

#### Buying Resale Tokens

1. Switch to a different buyer account in MetaMask (e.g., from Account 1 to Account 2)

> Note: This will cause an automatic page reload

2. Navigate to the homepage
3. Resale tokens will appear with their new prices
4. Follow the same buying process as described in the "Buying Music" section
5. After purchase:
   - The token transfers to the new owner's "My Tokens" tab
   - The token is removed from the previous owner's account
   - A sale record appears in the previous owner's "My Resales" tab (Sold Resales section)

## Additional Features

### Etherscan Integration

- A "View on Etherscan" button is available for each account
- Clicking this button opens Etherscan in a new tab, showing all transactions associated with the current account

### Route Restrictions

- Buyers can only access the following routes:
- "/" (Homepage)
- "/tokens" (My Tokens)
- "/resales" (My Resales)
- Attempting to access any other route will result in a 404 error page

## Troubleshooting

1. **MetaMask Detection Issues**

   - If MetaMask is not detected on first load, refresh the page
   - Ensure MetaMask is unlocked and connected to the correct network (Hardhat test network)

2. **Transaction Failures**

   - Check that you have sufficient ETH in your account for gas fees
   - Ensure you're using the correct account for the intended action (artist or buyer)

3. **Music Upload Failures**

   - Verify that all fields are filled correctly
   - Check that the file name only contains letters, numbers, hyphens, and underscores
   - Ensure your AWS S3 credentials are correctly configured
   - Refresh the page

4. **Playback Issues**

   - Check your internet connection
   - Try refreshing the page
   - Ensure the music file was uploaded successfully

5. **Smart Contract Deployment Errors**

   - Verify that Hardhat is running (`npx hardhat node`)
   - Check for any compilation errors in your Solidity code
   - Ensure you're running the deployment script from the project root directory

6. **404 Errors**

   - Confirm you're accessing allowed routes for your account type
   - Check for any typos in the URL

For any persistent issues, please contact the development team or submit an issue on the project's GitHub repository.
